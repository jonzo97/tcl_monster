{
  "version": "1.0",
  "project": "tcl_monster - Libero FPGA Automation Toolkit",
  "last_updated": "2025-11-12T16:45:00Z",
  "current_phase": "BeagleV-Fire Development - Phase 1: Setup & Understanding",

  "session_summary": {
    "date": "2025-11-12",
    "goal": "Initialize BeagleV-Fire FPGA design development (modify/extend reference design)",
    "time_invested": "~ongoing",
    "outcome": "✅ Explored BeagleV-Fire files, created development plan, started Phase 1",
    "next_session": "Continue Phase 1: Read reference TCL scripts, test Python builder"
  },

  "previous_session": {
    "date": "2025-11-12 (earlier)",
    "goal": "Fix MCP configuration naming collision and prepare for BeagleV-Fire design",
    "outcome": "✅ Fixed .mcp.json collision, set up Memory MCP with conditional usage"
  },

  "ddr4_debugging_summary": {
    "attempts": [
      "Created dual-output CCC (50MHz + 200MHz) - Working ✅",
      "Tried using pre-exported MI-V component with AXI disabled - Failed (no AXI interface)",
      "Created MI-V with AXI enabled inline - Failed (parameter validation error)",
      "Error: 'Illegal configuration value 0x0 for Start Address: Upper 16bits'"
    ],
    "root_cause_analysis": {
      "issue": "MI-V RV32 core parameter validation rejects certain address configurations",
      "app_notes_found": {
        "AN4229": "MI-V + DDR3 (not DDR4) - uses different IP core",
        "AN4597/DG0756": "PCIe + DDR4 (not MI-V) - different architecture",
        "AN4997": "Referenced but not found - likely has MI-V + DDR4 config"
      },
      "problem": "No working MI-V + DDR4 reference design readily available"
    },
    "time_estimate_to_fix": "Unknown - need AN4997 or extensive trial-and-error"
  },

  "recommended_path_forward": {
    "priority": "HIGH - Get working demo for tomorrow AM",
    "approach": "Use official MI-V + SRAM reference design",
    "design": "hdl/miv_polarfire_eval/Libero_Projects/PF_Eval_Kit_MIV_RV32_BaseDesign.tcl",
    "benefits": [
      "Full RISC-V RV32IMC processor (M+C extensions)",
      "~3000-4000 LUTs (way more complex than 33-LUT counter)",
      "Real peripherals: UART, GPIO, Timers, JTAG Debug",
      "Official Microchip design - guaranteed to work",
      "Can build and test tonight (~20-30 minutes)",
      "Real timing challenges for Build Doctor to analyze"
    ],
    "demo_narrative": "From simple counter (33 LUTs) to full RISC-V processor (3000+ LUTs) - Build Doctor scales to any complexity"
  },

  "build_diagnostics": {
    "status": "✅ Production Ready",
    "components": {
      "log_parser": "tools/diagnostics/log_parser.py",
      "build_doctor": "tools/diagnostics/build_doctor.py"
    },
    "tested_on": "libero_projects/counter_demo",
    "ready_for": "MI-V design analysis"
  },

  "smartdesign_automation": {
    "status": "✅ Code Complete, Unit Tested",
    "components": {
      "utilities": "tcl_scripts/lib/smartdesign/utilities/sd_helpers.tcl",
      "apb_interconnect": "tcl_scripts/lib/smartdesign/interconnect/apb_interconnect.tcl",
      "clock_reset_tree": "tcl_scripts/lib/smartdesign/interconnect/clock_reset_tree.tcl",
      "miv_minimal_template": "tcl_scripts/lib/smartdesign/templates/miv_rv32_minimal.tcl"
    },
    "test_status": "All tests passing ✅",
    "integration_status": "Not yet tested with real Libero project"
  },

  "next_steps_after_compact": {
    "immediate": [
      "1. Initialize BeagleV-Fire FPGA design (BeagleBoard project)",
      "2. Review existing beaglev_fire_* directories and config",
      "3. Determine design requirements and target device",
      "4. Set up project structure and TCL automation",
      "5. Create/configure Libero project for BeagleV-Fire"
    ],
    "context": "User has beaglev-fire-gateware/, beaglev_fire_demo/, config/beaglev_fire_config.json, tcl_scripts/beaglev_fire/ already present (untracked)",
    "priority": "HIGH - Active development work"
  },

  "infrastructure_updates_this_session": {
    "date": "2025-11-12",
    "changes": [
      "Renamed .mcp.json → PROJECT_STATE.json (fixed naming collision with MCP server config)",
      "Updated global ~/.claude/CLAUDE.md (removed non-existent Memory MCP references, added conditional usage guidance)",
      "Updated local .claude/CLAUDE.md (all .mcp.json → PROJECT_STATE.json)",
      "Created ~/meta-project workspace with auto-enabling Memory MCP",
      "Created ~/.claude/skills/memory-mcp/ for semantic control ('enable/disable memory mcp')",
      "Configured official Memory MCP server (knowledge graph: entities, relations, observations)",
      "Documented token costs (~7k overhead when enabled, 0 when disabled)"
    ],
    "rationale": "MCP configuration (.mcp.json) was being used for session state, causing conflicts. Separated concerns: PROJECT_STATE.json for session state, .mcp.json for actual MCP server config."
  },

  "mcp_servers_configured": {
    "fpga-docs": {
      "status": "✅ Active in tcl_monster project",
      "purpose": "FPGA documentation RAG system (27 PolarFire PDFs, ChromaDB)",
      "command": "python /home/jorgill/fpga_mcp/src/fpga_rag/mcp_server/server.py",
      "tools": ["search_fpga_docs", "query_ip_parameters", "explain_error", "get_timing_constraints"]
    },
    "memory": {
      "status": "⚙️ Conditionally enabled (only in ~/meta-project)",
      "purpose": "Cross-project knowledge graph (entities, relations, observations)",
      "token_cost": "~7k baseline overhead when enabled, 0 when disabled",
      "usage": "Enable for cross-project analysis, disable for siloed work",
      "storage": "~/.claude/knowledge_graph.json"
    }
  },

  "beaglev_fire_work": {
    "status": "✅ Phase 1 Complete - Ready for Phase 2 Integration",
    "started": "2025-11-12",
    "phase_1_completed": "2025-11-12",
    "project_goal": "Modify/extend BeagleV-Fire reference design with custom MSS, FPGA fabric, and cape connectors",
    "timeline": "Extended multi-session project",
    "focus_areas": ["MSS (RISC-V + peripherals)", "FPGA fabric (custom logic)", "Cape connectors (P8/P9)"],

    "resources_identified": {
      "beaglev-fire-gateware": {
        "type": "Complete reference design from BeagleBoard.org",
        "version": "v2.0.5 (default), v6.0.1 (PicoRV)",
        "purpose": "Production gateware with 8 build configurations",
        "builder": "Python script + YAML configs",
        "key_files": [
          "build-options/*.yaml - 8 different configurations",
          "recipes/libero-project/*.tcl - TCL build flow",
          "sources/FPGA-design/BUILD_BVF_GATEWARE.tcl - Main build script",
          "sources/FPGA-design/script_support/components/ - Modular HDL components"
        ]
      },
      "beaglev_fire_demo": {
        "type": "Empty Libero project skeleton",
        "purpose": "Starting point for custom designs",
        "device": "MPFS025T-FCVG484E",
        "status": "Fresh/empty - no HDL or constraints yet"
      },
      "tcl_scripts/beaglev_fire": {
        "type": "Minimal automation",
        "files": ["create_minimal_project.tcl"],
        "purpose": "Creates blank PolarFire SoC project"
      }
    },

    "device_info": {
      "fpga": "MPFS025T-FCVG484E (PolarFire SoC)",
      "package": "FCVG484 (484-pin BGA)",
      "cpu": "5x RISC-V cores (4x U54 @ 625MHz + 1x E51 monitor)",
      "fabric": "23K logic elements, 68 math blocks",
      "memory": "1.8 MB embedded RAM, 2GB LPDDR4 external",
      "io_pins": "108 FPGA pins",
      "peripherals": "2x GigE, USB 2.0, 5x UART, 2x SPI, 2x I2C, 2x CAN, 2x PCIe Gen2"
    },

    "build_configurations": [
      "default - Full design with cape + M.2 Wi-Fi",
      "minimal - Linux only, no FPGA fabric",
      "picorv-apu - PicoRV32 CPU in fabric",
      "sin-shls-apu - SmartHLS accelerator",
      "cape-4-uarts - 4 serial UART ports",
      "cape-comms - Communications cape",
      "click-boards - Click cape support",
      "robotics - Robotics cape",
      "board-tests - Device validation"
    ],

    "documentation": "docs/beaglev_fire_guide.md - Comprehensive reference",

    "development_plan": {
      "phase_1": "Setup & Understanding (~30-45 min) - IN PROGRESS",
      "phase_2": "Integration into tcl_monster (~1-2 hours)",
      "phase_3": "Custom Modifications (~2-3 hours)",
      "phase_4": "Automation & Documentation (~1-2 hours)"
    },

    "phase_1_tasks_completed": [
      "✅ Explored BeagleV-Fire files and understood structure (3 resources identified)",
      "✅ Created comprehensive development plan (4 phases)",
      "✅ Read and analyzed key reference TCL scripts (BUILD_BVF_GATEWARE, generate-project, import-clients, run-flow)",
      "✅ Analyzed Python builder workflow and requirements",
      "✅ Created project directory structure (libero_projects/beaglev_fire, hdl/beaglev_fire)",
      "✅ Created design variants configuration (config/beaglev_fire_variants.json with 8 variants)",
      "✅ Created comprehensive documentation (docs/beaglev_fire_guide.md - 825 lines)",
      "✅ Updated PROJECT_STATE.json with all Phase 1 findings"
    ],

    "phase_1_key_insights": [
      "BUILD_BVF_GATEWARE.tcl uses modular component architecture (CAPE, M2, APU, SYZYGY, MIPI_CSI)",
      "Parameter-driven configuration via TCL arguments (CAPE_OPTION:ROBOTICS syntax)",
      "Three-stage build flow pattern: generate-project → import-clients → run-flow",
      "Python builder combines HSS bootloader + FPGA bitstream (heavyweight approach)",
      "Opportunity for lightweight TCL-only build flow without Python dependencies",
      "Constraint organization is modular - each component has its own PDC/SDC files",
      "MSS configuration stored in mss.bundle (git bundle format)",
      "Multi-pass P&R strategy for timing closure (MAX delay → incremental MIN delay)"
    ],

    "token_savings": {
      "this_session": "~76k tokens (exploration + documentation)",
      "future_sessions": "~10k tokens (read guide only)",
      "savings_per_session": "~66k tokens (6.6x reduction)",
      "rationale": "Comprehensive documentation eliminates need to re-explore reference design"
    },

    "next_action": "Phase 2 - Extract reference components and create tcl_monster integration scripts"
  },

  "git_status": {
    "branch": "main",
    "uncommitted_changes": true,
    "staged": [".mcp.json → PROJECT_STATE.json (rename)"],
    "modified": [".claude/CLAUDE.md"],
    "untracked": ["beaglev-fire-gateware/", "beaglev_fire_demo/", "config/beaglev_fire_config.json", "tcl_scripts/beaglev_fire/"],
    "notes": "Infrastructure changes ready to commit. BeagleV-Fire files not yet committed."
  },

  "context_management": {
    "current_usage": "81k / 200k tokens (40.5%)",
    "recommendation": "Compact now before BeagleV-Fire work",
    "reason": "Clear infrastructure setup context, start fresh with BeagleV-Fire design"
  },

  "key_learnings": [
    "MI-V + DDR4 is more complex than expected without proper app note",
    "AN4229 has MI-V + DDR3 (not DDR4)",
    "AN4597 has PCIe + DDR4 (not MI-V)",
    "Official MI-V reference uses SRAM, not DDR",
    "Always verify app note covers exact use case before committing time",
    "For demos: working design > perfect design",
    ".mcp.json is ONLY for MCP server configuration - use PROJECT_STATE.json for session state",
    "Memory MCP has ~7k token overhead - only enable for cross-project work",
    "Official Memory MCP server exists and works (entities/relations/observations)",
    "Project-scoped MCP config auto-enables when cd to directory (~/meta-project pattern)"
  ],

  "coworker_presentation": {
    "scheduled": "Tomorrow morning",
    "demo_status": "✅ READY! Counter + MI-V processor demos complete",
    "deliverables": {
      "counter_demo": "33 LUTs, baseline validation",
      "miv_demo": "11,607 LUTs, complete RISC-V processor",
      "build_doctor": "Intelligent analysis on both designs",
      "comparison": "351x complexity scaling demonstrated"
    },
    "presentation_file": "DEMO.md",
    "github_repo": "https://github.com/jonzo97/libero_bot"
  },

  "miv_demo_achievements": {
    "completed": "2025-10-30",
    "build_status": "✅ Synthesis + P&R successful",
    "resources": {
      "luts": "11,607 / 299,544 (3.87%)",
      "ffs": "5,644 / 299,544 (1.88%)",
      "logic_elements": "11,771 total",
      "io_pins": "8 (all placed)"
    },
    "components": [
      "MI-V RV32IMC processor (Integer + Multiply + Compressed)",
      "64kB on-chip SRAM (LSRAM)",
      "UART peripheral",
      "4x GPIO outputs (LEDs)",
      "2x CoreTimer peripherals",
      "JTAG debug interface",
      "Complete clock/reset infrastructure"
    ],
    "build_time": "~25-30 minutes (automated)",
    "errors": 0,
    "warnings": 0
  },

  "utility_scripts_created": {
    "create_miv_simple.tcl": "Complete MI-V project creation from scratch",
    "build_miv_simple.tcl": "Automated synthesis + P&R",
    "generate_constraints.tcl": "Pin constraints for MPF300 eval board",
    "generate_bitstream.tcl": "Programming file generation",
    "extract_reports.tcl": "Build report extraction and formatting"
  },

  "documentation_updates": {
    "DEMO.md": "Comprehensive presentation guide with MI-V demo",
    "QUICKSTART.md": "Updated with MI-V quick start",
    "docs/build_comparison.md": "Detailed counter vs. MI-V comparison"
  },

  "future_enhancements": {
    "ddr4_integration": {
      "priority": "Medium",
      "blocker": "Need AN4997 app note or working reference design",
      "alternative": "Use DDR3 (AN4229 has this) if DDR4 not critical"
    }
  }
}
