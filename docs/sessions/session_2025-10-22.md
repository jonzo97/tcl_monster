# Session 2025-10-22 - Autonomous Compaction Framework & MI-V Core Integration

## Session Goals
- Fix three critical issues from compaction: Memory MCP, autonomous compaction, MI-V cores
- Set up intelligent context management across all projects
- Switch from PicoRV32 to Microchip MI-V cores

## Completed ✅

### 1. Switched to Microchip MI-V Cores
- **Deleted:** PicoRV32 clone (third-party)
- **Cloned:** Three MI-V repositories as git submodules:
  - `hdl/miv_polarfire_eval/` - Reference designs (1.4GB)
  - `hdl/miv_platform/` - HAL and drivers (100 files)
  - `hdl/miv_documentation/` - User guides
- **Discovered:** MI-V RV32 is a Libero IP catalog core (not raw RTL)
  - VLNV: `Microsemi:MiV:MIV_RV32:3.1.200`
  - Auto-downloads via `create_and_configure_core -download_core`
- **Reference Design:** `PF_Eval_Kit_MIV_RV32_BaseDesign.tcl` - complete system for MPF300 Eval Kit

### 2. Git Repository Setup
- **Initialized:** Git in `/mnt/c/tcl_monster`
- **Remote:** Connected to `github.com:jonzo97/libero_bot`
- **Commits:**
  - Initial commit: 224 files (counter design, TCL scripts, docs)
  - Submodules commit: Converted MI-V repos to proper git submodules
- **Discovered:** Project name inconsistency resolved (tcl_monster local = libero_bot GitHub)

### 3. Autonomous Compaction Framework
- **Created:** Universal context-management skill
  - Location: `~/.claude/skills/context-management/SKILL.md`
  - Triggers: "save context", "compact", "checkpoint", "let's save and compact"
  - Works across ALL projects (not project-specific)
- **Updated:** `.claude/CLAUDE.md` with compaction protocols
  - Thresholds: <75% safe, 75-85% plan, 85-90% warn, 90-95% urgent, >95% critical
  - Pre-compact checklist
  - Best practices from Anthropic and community
- **Disabled:** Project-specific slash commands (moved to `.disabled/`)
  - Rationale: Skills are universal and speech-to-text friendly

### 4. Documentation Updates
- **Updated:** `.claude/CLAUDE.md` with MI-V core section
  - Core instantiation patterns
  - Configuration options (CFG1/CFG2/CFG3)
  - GitHub resources and reference designs
  - Explicit guidance: "DO NOT use third-party RISC-V cores"

## In Progress ⏳
- **Memory MCP Configuration** - Deferred to tomorrow
  - Research complete, understands graph database approach
  - Needs: npx install, --memory-path configuration

## Decisions Made

### 1. MI-V Cores Over Third-Party
- **Context:** Originally started with PicoRV32 (open-source)
- **Decision:** Switch to Microchip MI-V cores
- **Rationale:**
  - Official Microchip IP (better support)
  - Libero catalog core (auto-download)
  - Complete reference designs available
  - Recommended by Microchip app note AN4997
- **Impact:** All RISC-V work uses MI-V going forward

### 2. Universal Skill vs Slash Commands
- **Context:** User uses speech-to-text across multiple machines/projects
- **Decision:** Create universal skill instead of project slash commands
- **Rationale:**
  - Skills trigger semantically ("let's save and compact")
  - Work across all projects automatically
  - Sync via existing ~/.claude/ sync solution
  - Speech-to-text friendly (no exact syntax needed)
- **Impact:** Natural language triggers work everywhere

### 3. Defer Memory MCP Until Tomorrow
- **Context:** Memory MCP requires setup, currently using .mcp.json
- **Decision:** Delay configuration to next session
- **Rationale:**
  - .mcp.json works adequately for now
  - Sufficient context (48%) for MI-V work
  - User wanted to start MI-V integration
- **Impact:** Will switch to graph database tomorrow

## Files Created/Modified

**Created:**
- `~/.claude/skills/context-management/SKILL.md` - Universal context management
- `.mcp.json` - Updated project state for this session
- `docs/sessions/session_2025-10-22.md` - This file
- `.gitmodules` - Git submodule configuration

**Modified:**
- `.claude/CLAUDE.md` - Added MI-V section, compaction protocols

**Cloned (as submodules):**
- `hdl/miv_polarfire_eval/`
- `hdl/miv_platform/`
- `hdl/miv_documentation/`

**Disabled:**
- `.claude/commands/compact-check.md` → `.disabled/`
- `.claude/commands/save-state.md` → `.disabled/`

## Key Learnings

### MI-V Core Architecture
- MI-V cores are NOT raw RTL files
- They're Libero IP catalog cores with VLNV identifiers
- Complete reference design includes SmartDesign builder scripts
- Component configs in `import/components/MIV_RV32_CFG*.tcl` show exact parameters
- Example instantiation:
```tcl
create_and_configure_core \
    -core_vlnv {Microsemi:MiV:MIV_RV32:3.1.200} \
    -download_core \
    -component_name {MIV_RV32_CFG1_C0} \
    -params {"M_EXT:true" "C_EXT:true" "TCM_PRESENT:true" ...}
```

### Context Management Best Practices (from research)
- **Anthropic:** "Curate the smallest high-signal set of tokens"
- **BinaryVerseAI:** Compact every 5-7 conversational turns
- **Experts:** Don't wait for 95% auto-compact - manual compact before pivoting
- **Philosophy:** Treat context like RAM, files like persistent storage

### Skill vs Slash Command Trade-offs
| Feature | Slash Commands | Skills |
|---------|----------------|--------|
| Scope | Project-only | All projects |
| Trigger | Exact syntax | Semantic |
| Speech-friendly | ❌ No | ✅ Yes |
| Sync | Manual (git) | Automatic |

## Next Session Tasks

**High Priority:**
- [ ] Configure Memory MCP server
  ```bash
  npx -y @modelcontextprotocol/server-memory --memory-path ~/.claude-memory
  ```
- [ ] Update context-management skill to use Memory MCP if available
- [ ] Adapt MI-V reference design for tcl_monster framework
  - Study `PF_Eval_Kit_MIV_RV32_BaseDesign.tcl`
  - Extract reusable patterns
  - Create tcl_monster version

**Medium Priority:**
- [ ] Create `.gitignore` for Libero build artifacts
- [ ] Update `docs/RISCV_DDR_DESIGN.md` to reflect MI-V approach
- [ ] Test counter design on MPF300 Eval Kit hardware

**Low Priority:**
- [ ] Fix report file paths in `generate_reports.tcl`
- [ ] Research timing-driven P&R TCL commands

## Notes for Recovery

**Critical Context:**
- MI-V core: Libero catalog IP, not RTL files
- Reference design at: `hdl/miv_polarfire_eval/Libero_Projects/PF_Eval_Kit_MIV_RV32_BaseDesign.tcl`
- GitHub repo: `jonzo97/libero_bot` (not tcl_monster)
- Skill location: `~/.claude/skills/context-management/`
- Triggers: "save context", "compact", "checkpoint"

**Files to Read Next Session:**
1. `.mcp.json` - Project state
2. This file - Session summary
3. `hdl/miv_polarfire_eval/README.md` - MI-V overview
4. `hdl/miv_polarfire_eval/Libero_Projects/PF_Eval_Kit_MIV_RV32_BaseDesign.tcl` - Reference design

**Key Commands:**
```bash
cd /mnt/c/tcl_monster
git status  # Check for uncommitted changes
ls hdl/miv_polarfire_eval/Libero_Projects/  # See reference designs
```

## Session Statistics
- **Duration:** ~2 hours
- **Context used:** 48.9% (97.7k / 200k tokens) at session end
- **Git commits:** 2 (initial + submodules)
- **Files created:** 4
- **Files modified:** 1
- **Submodules added:** 3
- **Skills created:** 1 (universal)
- **Compaction:** Recommended but not critical (safe zone)
